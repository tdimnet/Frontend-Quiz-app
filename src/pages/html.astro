---
import DefaultLayout from "../layouts/DefaultLayout.astro";

import data from "../data.json";

const theme = "HTML";
const quiz = data.quizzes.filter((q) => q.title === theme)[0];

import SubmitButton from '../components/SubmitButton.astro'
import Answer from "../components/Answer.astro"
import ProgressBar from "../components/ProgressBar.astro"
---

<DefaultLayout>
  <p>Question <span class="question-number">1</span> of 10</p>
  <p class="question">
    Which of these color contrast ratios defines the minimum WCAG 2.1 Level AA
    requirement for normal text?
  </p>

  <ProgressBar />
  
  <ul class="answers-wrapper">
    <Answer number="A" content="4.5 : 1" />
    <Answer number="B" content="3 : 1" />
    <Answer number="C" content="2.5 : 1" />
    <Answer number="D" content="5 : 1" />
  </ul>

  <SubmitButton id="submit-btn" label="Submit Answer" />
</DefaultLayout>

<style>
  .answers-wrapper {
    list-style-type: none;
    padding-left: 0;
    
    li {
      margin-bottom: 12px;
    }
  }
</style>

<script define:vars={{ quiz }}>
  const $submitBtn = document.querySelector("#submit-btn");
  const $question = document.querySelector(".question");
  const questions = quiz.questions;

  // Asign first question
  $question.textContent = questions[0].question;

  $answerBtns = document.querySelectorAll('.answer-btn')

  // Adding class for testing purpose
  $answerBtns[0].classList.add('active')
  $answerBtns[1].classList.add('correct-answer')
  $answerBtns[2].classList.add('wrong-answer')

  $answerBtns.forEach($btn => $btn.addEventListener('click', function(e) {
    $btn.classList.add('active')
  }))

  function createAnswer(options) {
    let answers = [];

    for (let i = 0; i < options.length; i++) {
      $answer = document.createElement("li");
      $answer.classList.add("answer");
      $answer.textContent = options[i];

      answers.push($answer)
    }

    return answers
  }

  $submitBtn.addEventListener("click", function () {
    const questionNumber = document.querySelector(".question-number");
    const $answersWrapper = document.querySelector(".answers-wrapper");
    const $answers = document.querySelectorAll(".answer");

    Number(questionNumber.textContent++);

    const currentQuestion = questions[questionNumber.textContent];
    $question.textContent = currentQuestion.question;

    // Remove all possible answers
    $answers.forEach(($answer) => $answersWrapper.removeChild($answer));

    const answers = createAnswer(currentQuestion.options)

    answers.forEach(answer => $answersWrapper.appendChild(answer))
    $answersWrapper.addEventListener('click', function(e) {
        console.log(e.target)
    })
  });
</script>
